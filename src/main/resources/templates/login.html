<!doctype html>
<html lang="en" dir="ltr" xmlns:th="http://thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<meta name="viewport"
		content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">

	<link rel="icon" th:href="@{/assets/Images/favicon.png}" type="image/x-icon" />
	<title>SK PMA - Login</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<!-- Bootstrap Core and vandor -->

	<link rel="stylesheet" th:href="@{/assets/plugins/bootstrap/css/bootstrap.min.css}" />
	<!-- Core css -->
	<link rel="stylesheet" th:href="@{/assets/css/main.css}" />
	<link rel="stylesheet" th:href="@{/assets/css/theme1.css}" />

</head>

<body class="font-montserrat">
	<div class="auth">
		<div class="auth_left">
			<div class="card">
				<div class="text-center mb-2">
					<a class="header-brand" href="index.html"><img th:src="@{/assets/Images/sklogo.svg}"
							class="img-fluid" alt="" /></a>
				</div>
				<div class="mb-4">
					<div class="row">
						<div class="col-12 col-sm-12 col-8 main-section">
							<h3 class="text-center text-inverse pt-2 pb-4">Work Management</h3>
							<form class="container" id="needs-validation" 
								th:action="@{/login}" method="post" onsubmit="return validateFormData()">
								<div class="row">									
									<div  class="alert alert-danger col-md-12 col-sm-12 col-12"  th:if="${param.error}"
										role="alert" th:with="errorMsg=${session['SPRING_SECURITY_LAST_EXCEPTION'].message}" 
										style="text-align: center;">
										<b><span th:text="${errorMsg}">Internal Server Error</span></b>
									</div>
									<div class="alert alert-danger col-md-12 col-sm-12 col-12" style="text-align: center;" th:if="${error!=null}">
										<b><span th:text="${error}"></span></b>
									</div>
									<div  class="alert alert-success col-md-12 col-sm-12 col-12" th:if="${param.success}"
										style="text-align: center;">
										<span id="success-span" th:text="${param.success}"></span>
									</div>
									<div class="col-md-12 col-sm-12 col-12">
										<div class="form-group">
											<label class="form-label" for="inputEmail4">Email Address</label>
											<input type="email" class="form-control" name="username"  id="email"
												placeholder="Enter Email" >
											<div class="invalid_email" style="color: red;"></div>
										</div>
									</div>
									<div class="col-lg-12 col-sm-6 col-12">
										<a th:href="@{/login/forgotPassword}"
														class="float-right small">forgot password ?</a>
									</div>
									<div class="col-lg-12 col-sm-6 col-12">
										<div class="form-group">
											<label class="form-label" style="display: block;"
												for="inputpassword">Password </label>
											<input type="password" class="form-control" id="inputpassword"
												placeholder="Enter password" name="password" autocomplete="current-password">
											<div class="invalid_password" style="color: red;"></div>
										</div>
									</div>
								</div>
<!--								<div class="row">
									<div class="col-12">
										<div class="form-group">
											<div class="form-check">
												<input class="form-check-input" type="checkbox" name="rememberMe"
													value="true" id="rememberMe">
												<label class="form-check-label" for="rememberMe">Remember me</label>
											</div>
										</div>
									</div>
								</div>
-->
								<div class="row">
									<div class="col-lg-12 col-sm-12 col-12 text-center">
										<button class="btn btn-primary w-100 reg" style="width:100%;"
											type="submit">Login</button>
									</div>
								</div>
							</form>
						</div>
					</div>
				</div>
<!--				<div class="col-12 text-center text-muted" style="font-size:14px;">-->
<!--					Don't have account yet? <a th:href="@{register.html}">Create an account</a>-->
<!--				</div>-->
			</div>
		</div>
		<div class="auth_right full_img"></div>
	</div>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js" integrity="sha512-2rNj2KJ+D8s1ceNasTIex6z4HWyOnEYLVC3FigGOmyQCZc2eBXKgOxQmo3oKLHyfcj53uz4QMsRCWNbLd32Q1g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script th:src="@{/assets/bundles/lib.vendor.bundle.js}"></script>
	<script th:src="@{/assets/js/core.js}"></script>
	
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js"></script>

	<script id="rendered-js">
		/*
		(function () {
			'use strict';
			window.addEventListener('load', function () {
				var form = document.getElementById('needs-validation');
				form.addEventListener('submit', function (event) {
					if (form.checkValidity() === false) {
						event.preventDefault();
						event.stopPropagation();
					}
					form.classList.add('was-validated');
				}, false);
			}, false);
		})();
		*/
		
		function validateFormData() {
			let emailData = $("#email").val();
			let passwordData = $("#inputpassword").val();
			let errorStr = "";
			
			//store rememberMe
			storeRememberMe();
			
			if(emailData === "") {
				$(".invalid_email").text("Email cannot be empty");
				$("#email").css("border-color", "red");
				errorStr = errorStr+"error ";
			}else if(!(regExpPattern.test(emailData))) {
				$(".invalid_email").text("Please enter a valid email address");
				$("#email").css("border-color", "red");
			} else {
				$(".invalid_email").text("");
				$("#email").css("border-color", "#E8E9E9");
			}
			
			if(passwordData === "") {
				$(".invalid_password").text("Password cannot be empty");
				$("#inputpassword").css("border-color", "red");
				errorStr = errorStr+"error ";
				//return false;
			} else {
				$(".invalid_password").text("");
				$("#inputpassword").css("border-color", "#E8E9E9");
			}
			
			if(!errorStr.includes("error")) {
				return true;
			}	
			return false;
		}
		
		function storeRememberMe() {
			const rememberMeChecked = "";
			if($("#rememberMe").is(":checked")) {
				rememberMeChecked = document.getElementById('rememberMe').checked;
		    	sessionStorage.setItem('rememberMe', rememberMeChecked);
			} else {
				rememberMeChecked = document.getElementById('rememberMe').checked;
				sessionStorage.setItem('rememberMe', rememberMeChecked);
			}
		}
		
		$(document).ready(function(){
			sessionStorage.removeItem("userEmail");
			$("#email").on("change", function(){
				let regExpPattern = new RegExp(/^(?!\d)[A-Za-z][\w.-]*@skinternational\.[a-zA-Z]{2,}$/);
				let emailData = $("#email").val();
				if(emailData === "") {
					$(".invalid_email").text("Email cannot be empty");
					$("#email").css("border-color", "red");
				} else if(!(regExpPattern.test(emailData))) {
					$(".invalid_email").text("Please enter a valid email address");
					$("#email").css("border-color", "red");
				} else {
					$(".invalid_email").text("");
					$("#email").css("border-color", "#E8E9E9");
				}
			});
			
			$("#inputpassword").on("change", function(){
				let passwordData = $("#inputpassword").val();
				if(passwordData === "") {
					$(".invalid_password").text("Password cannot be empty");
					$("#inputpassword").css("border-color", "red");
					//return false;
				} else {
					$(".invalid_password").text("");
					$("#inputpassword").css("border-color", "#E8E9E9");
				}
			});
			
			$("#rememberMe").on("change", function() {
				const rememberMeChecked = "";
				if($("#rememberMe").is(":checked")) {
			    	sessionStorage.setItem('rememberMe', "true");
				} else {
					sessionStorage.removeItem('rememberMe');
				}
			});
		});
		
	</script>
</body>
</html>